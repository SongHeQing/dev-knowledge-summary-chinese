# 数据库知识总结
<br>

**MySQL 中 `VARCHAR(N)` 里的 `N`，从 MySQL 4.1 版本开始，** **明确指的是** **字符数限制，而不是字节数限制。**

-----

### `VARCHAR(N)`：是字符数限制，不是字节数

这是 MySQL 官方文档的明确规定和行为：

  * 当您定义一个列为 `VARCHAR(100)`，它表示该列可以存储**最多 100 个字符**。
  * 无论您使用的是单字节字符集（如 `latin1`，一个字符占 1 字节）还是多字节字符集（如 `UTF-8`，一个中文字符可能占 3 字节，一个表情符号可能占 4 字节），这个 `100` 始终是**字符的数量**。

**例子：**

  * 如果您的列定义为 `VARCHAR(50)`：
      * 您可以存储 50 个英文字符（例如 `'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa'`），这会占用 50 字节。
      * 您也可以存储 50 个中文字符（例如 `'你好你好你好你好...（重复50次）'`），这会占用 50 \* 3 = 150 字节（在 UTF-8 编码下）。

在这两种情况下，存储的**字符数**都没有超过 50，所以 MySQL 不会报告 "Data too long" 错误。

-----

### 为什么会有字节数的误解？

这个误解通常来源于以下几个方面：

1.  **MySQL 早期版本（4.0 及更早）：** 在 MySQL 4.1 之前，`VARCHAR` 的长度确实是以字节为单位的。这是一个重要的历史变化，导致了许多混淆。
2.  **最大行长度限制：** MySQL 的行也有一个最大长度限制（通常约为 65,535 字节，或 64KB）。即使 `VARCHAR(N)` 的 `N` 是字符数，但如果行中所有列的**总字节数**超过了这个限制，那么即使单个 `VARCHAR` 列的字符数没有达到其 `N` 的上限，也可能因为总字节数过大而导致问题。但这与单个 `VARCHAR` 列的 `N` 是字符数还是字节数是不同的概念。
3.  **实际存储空间的计算：** 正如我们之前讨论的，尽管 `N` 是字符数，但实际占用的**存储空间**（字节）确实会根据字符集编码而变化。这可能会让人误以为 `N` 也是在控制字节数。

-----

### 如何验证？

您可以通过简单的测试来验证这一点：

1.  创建一个数据库表，并将字符集设置为 `utf8mb4`（支持更广泛的字符，包括表情符号，一个字符可能占 1-4 字节）。

    ```sql
    CREATE TABLE test_varchar_length (
        id INT AUTO_INCREMENT PRIMARY KEY,
        my_column VARCHAR(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci
    );
    ```

2.  尝试插入 10 个中文字符（每个占 3 字节）：

    ```sql
    INSERT INTO test_varchar_length (my_column) VALUES ('一二三四五六七八九十'); -- 10 个字符
    ```

    这条语句会**成功执行**，尽管它占用了 30 字节的存储空间。如果 `N` 是字节数限制，那么它就不应该成功（因为 30 \> 10）。

3.  尝试插入 11 个英文字符：

    ```sql
    INSERT INTO test_varchar_length (my_column) VALUES ('abcdefghijk'); -- 11 个字符
    ```

    这条语句会**报错** `Data too long for column 'my_column'`，因为字符数超过了 10。

-----

### 结论

综上所述，**MySQL 的 `VARCHAR(N)` 中的 `N` 指的是字符数限制**。当您遇到 "Data too long for column" 错误时，需要检查的是您尝试插入的字符串的**字符数量**是否超出了列定义的 `N`。
